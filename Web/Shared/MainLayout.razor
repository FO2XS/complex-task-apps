@inherits LayoutComponentBase
@inject IBootstrapCss BootstrapCSS

@using Test.Data
@using Test.Data.Modal
@inject WebService service

<link rel=stylesheet type="text/css" href="~/css/site.css">
<div class="menu">
    <div class="logo-and-type-game-and-technical-support">
        <div class="logo">
            <NavLink href="" Match="NavLinkMatch.All">
            </NavLink>
        </div>
        <div class="type-game">
            <select>
                <option selected>
                    <NavLink href="" Match="NavLinkMatch.All">
                        CS:GO
                    </NavLink>
                </option>
                <option>
                    <NavLink href="" Match="NavLinkMatch.All">
                        LoL
                    </NavLink>
                </option>
            </select>
        </div>
    </div>
    <div class="technical-support">

        
        <BSButton OnClick="@(() => GetBets())">Нажми чтобы появились ставки</BSButton>


        <BSModal @ref="Modal">
            <BSModalHeader OnClick="@(() => Modal.Hide())">Выбор ставки</BSModalHeader>
            <BSModalBody>
                @if (@Event != null)
                {
                    <BSTable IsBorderless = "true">
                        <tbody style="text-align: center;">
                            <tr>
                                <td>@Event.IdTeam1Navigation.Title
                                    <BSImage style="max-width: 75px;" IsRounded="true" Alignment="Alignment.Center" src="@Event.IdTeam1Navigation.Logo" alt="Thumbnail image" />
                                </td>
                                <td style="vertical-align: middle;">VS</td>
                                <td>@Event.IdTeam2Navigation.Title
                                    <BSImage style="max-width: 75px;" IsRounded="true" Alignment="Alignment.Center" src="@Event.IdTeam2Navigation.Logo" alt="Thumbnail image" />
                                </td>
                            </tr>
                        </tbody>
                    </BSTable>
                    <hr>
                    <BSTable IsBorderless = "true">
                        <tbody style="text-align: center;">
                            @foreach (var bet in Bets)
                            {
                                <tr>
                                <td>
                                    <BSButton Size = "Size.Small">Поставить</BSButton>
                                </td>
                                <td>@bet.Coef1</td>
                                <td>@bet.IdTobNavigation.Title</td>
                                <td>@bet.Coef2</td>
                                <td>
                                    <BSButton Size = "Size.Small">Поставить</BSButton>
                                </td>
                                </tr>
                            }
                        </tbody>
                    </BSTable>
                }
            </BSModalBody>
            <BSModalFooter>
                <BSButton Color="Color.Secondary" @onclick="@(() => Modal.Hide())">Закрыть</BSButton>
            </BSModalFooter>
        </BSModal>



        Тех. поддержка
    </div>

    <div class="custom-features">
        <div class="FAQ">FAQ</div>
        <div class="log-in-log-up">
            <button class="user-button">log in</button>
            <button class="user-button">log up</button>
        </div>
        <div>
        </div>
    </div>
    <div>
    </div>
</div>
<div class="content px-4">
    @Body
</div>

@code{
    ////////////////////////////////////////////////////////////////
    private BSModal Modal { get; set; }
    private Event Event { get; set; }

    private List<PossibleBet> Bets { get; set; }


    private void GetBets()
    {
        var temp = service.GetFutureEvents(new Sport { Id = 1 });
        Event = temp[2];

        Bets = service.GetPossibleBets(Event);

        Modal.Show();
    }














    /////////////////////////////////////////
    private Boolean isServerSide = false;
    protected override async System.Threading.Tasks.Task OnInitializedAsync()
    {
        try
        {
            await BootstrapCSS.SetBootstrapCss("4.3.1");
        }
        catch (Exception)
        {
            isServerSide = true;
        }
    }
    protected override async System.Threading.Tasks.Task OnAfterRenderAsync(Boolean firstRun)
    {
        if (isServerSide && firstRun)
            await BootstrapCSS.SetBootstrapCss();
    }
}