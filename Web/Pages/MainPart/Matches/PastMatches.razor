@using Test.Pages.PopUpWindows
@inject IDialogService _dialogService


<div class="active-matches">
    <div class="list-of-active-matches card">
        <div class="active-matches-title">
            <SearchAndLiftMatches Events="@Events" Step="@step" LeafEventsCallback="@LeafDisplayEvents"></SearchAndLiftMatches>
        </div>

        <ul>
            @foreach (var selectEvent in displayEvents)
            {
                <li>
                    <div class="active-matches-bet">
                        @if (selectEvent.IdWin == selectEvent.IdTeam1 && selectEvent.IdWin != null)
                        {
                            <div class="team-left">
                                <div class="team-win">
                                    <div class="logo-team">
                                        <img src="@selectEvent.IdTeam1Navigation.Logo">
                                    </div>
                                    <p class="title">@selectEvent.IdTeam1Navigation.Title</p>
                                    <div class="koef">
                                        <p>@(GetCoef1(selectEvent.PossibleBets))</p>
                                        <hr />
                                    </div>
                                </div>
                            </div>
                            <div class="main-info">
                                <div class="matches-bet-info">
                                    <p class="tournament-title">ESEA Advanced NA</p>
                                    <p class="type-bo">BO3</p>
                                    <p class="time">@((@DateTime.Now - selectEvent.StartDate).ToString(@"hh\:mm\:ss"))</p>
                                </div>
                            </div>
                            <div class="team-right">
                                <div class="team-lose">
                                    <div class="logo-team">
                                        <img src="@selectEvent.IdTeam2Navigation.Logo">
                                    </div>
                                    <p class="title">@selectEvent.IdTeam2Navigation.Title</p>
                                    <div class="koef">
                                        <p>@(GetCoef2(selectEvent.PossibleBets))</p>
                                        <hr />
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="team-left">
                                <div class="team-lose">
                                    <div class="logo-team">
                                        <img src="@selectEvent.IdTeam1Navigation.Logo">
                                    </div>
                                    <p class="title">@selectEvent.IdTeam1Navigation.Title</p>
                                    <div class="koef">
                                        <p>@(GetCoef1(selectEvent.PossibleBets))</p>
                                        <hr />
                                    </div>
                                </div>
                            </div>
                            <div class="main-info">
                                <div class="matches-bet-info">
                                    <p class="tournament-title">ESEA Advanced NA</p>
                                    <p class="type-bo">BO3</p>
                                    <p class="time">@((@DateTime.Now - selectEvent.StartDate).ToString(@"hh\:mm\:ss"))</p>
                                </div>
                            </div>
                            <div class="team-right">
                                <div class="team-win">
                                    <div class="logo-team">
                                        <img src="@selectEvent.IdTeam2Navigation.Logo">
                                    </div>
                                    <p class="title">@selectEvent.IdTeam2Navigation.Title</p>
                                    <div class="koef">
                                        <p>@(GetCoef2(selectEvent.PossibleBets))</p>
                                        <hr />
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </li>
            }
        </ul>
    </div>
</div>




@code {
    [CascadingParameter]
    public Sport SelectSport { get; set; }

    [Parameter]
    public List<Event> Events { get; set; }

    private List<Event> displayEvents { get; set; }

    private int step = 10;


    private String GetCoef1(ICollection<PossibleBet> ts)
    {
        var tob = ts.FirstOrDefault(x => x.IdTob == StorageKeys.GeneralBetId);
        return tob is null ? "null" : tob.Coef1.ToString();
    }
    private String GetCoef2(ICollection<PossibleBet> ts)
    {
        var tob = ts.FirstOrDefault(x => x.IdTob == StorageKeys.GeneralBetId);
        return tob is null ? "null" : tob.Coef2.ToString();
    }


    private void ClickEvent(Event selectEvent)
    {
        var parameter = new DialogParameters { { "CurrentEvent", selectEvent } };

        var dialog = _dialogService.Show<SelectBetModal>("Выбор ставки", parameter);
    }

    protected override Task OnParametersSetAsync()
    {
        displayEvents = step >= Events.Count ? Events.GetRange(0, Events.Count).ToList() : Events.GetRange(0, step).ToList();
        return base.OnParametersSetAsync();
    }

    private void LeafDisplayEvents(List<Event> newDisplayEvents)
    {
        displayEvents = newDisplayEvents;
    }
}
